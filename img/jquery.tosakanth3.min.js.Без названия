(function($){$.tosakanth=new function(){var get_hash_attr=function(hash){var attr={uri:'',params:{}};if(hash!=null&&hash!=''){var tmp=hash.split('?');var uristr=tmp[0];var uripos=uristr.indexOf('!');if(uripos==-1)uripos=0;else uripos+=1;attr.uri=uristr.substr(uripos);attr.params={};if(tmp.length>1){if(tmp[1]!=''){parse_str(tmp[1],attr.params)}}}
return attr};var str2obj=function(hash){var params={};if(hash!=null&&hash!=''){var sharp=hash.indexOf('#');if(sharp>0){}
var tmp=hash.split('?');var uristr=tmp[0];var uripos=uristr.indexOf('!');if(uripos==-1)uripos=0;else uripos+=1;var uri=uristr.substr(uripos);if(tmp.length>1){if(tmp[1]!=''){var ttt=tmp[1];var sharp=ttt.indexOf('#');if(sharp>0){ttt=ttt.substr(0,sharp)}
parse_str(ttt,params)}}}
return params};function parse_str(str,array){var glue1='=',glue2='&',array2=String(str).replace(/^&?([\s\S]*?)&?$/,'$1').split(glue2),i,j,chr,tmp,key,value,bracket,keys,evalStr,that=this,fixStr=function(str){return that.decodeURIComponent(str.replace(/\+/g,'%20')).replace(/([\\"'])/g,'\\$1').replace(/\n/g,'\\n').replace(/\r/g,'\\r')};if(!array){array=this.window}
for(i=0;i<array2.length;i++){tmp=array2[i].split(glue1);if(tmp.length<2){tmp=[tmp,'']}
key=fixStr(tmp[0]);value=fixStr(tmp[1]);while(key.charAt(0)===' '){key=key.substr(1)}
if(key.indexOf('\0')!==-1){key=key.substr(0,key.indexOf('\0'))}
if(key&&key.charAt(0)!=='['){keys=[];bracket=0;for(j=0;j<key.length;j++){if(key.charAt(j)==='['&&!bracket){bracket=j+1}
else if(key.charAt(j)===']'){if(bracket){if(!keys.length){keys.push(key.substr(0,bracket-1))}
keys.push(key.substr(bracket,j-bracket));bracket=0;if(key.charAt(j+1)!=='['){break}}}}
if(!keys.length){keys=[key]}
for(j=0;j<keys[0].length;j++){chr=keys[0].charAt(j);if(chr===' '||chr==='.'||chr==='['){keys[0]=keys[0].substr(0,j)+'_'+keys[0].substr(j+1)}
if(chr==='['){break}}
evalStr='array';for(j=0;j<keys.length;j++){key=keys[j];if((key!==''&&key!==' ')||j===0){key="'"+key+"'"}
else{key=eval(evalStr+'.push([]);')-1}
evalStr+='['+key+']';if(j!==keys.length-1&&eval('typeof '+evalStr)==='undefined'){eval(evalStr+' = [];')}}
evalStr+=" = '"+value+"';\n";eval(evalStr)}}}
function trim(str,charlist){var whitespace,l=0,i=0;str+='';if(!charlist){whitespace=" \n\r\t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000"}else{charlist+='';whitespace=charlist.replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^\:])/g,'$1')}
l=str.length;for(i=0;i<l;i++){if(whitespace.indexOf(str.charAt(i))===-1){str=str.substring(i);break}}
l=str.length;for(i=l-1;i>=0;i--){if(whitespace.indexOf(str.charAt(i))===-1){str=str.substring(0,i+1);break}}
return whitespace.indexOf(str.charAt(0))===-1?str:''}
var obj2str=function(obj,head){head=head||'';if(typeof obj=='undefined'){return head}else if(obj==null){return null}else if(typeof obj=='array'||typeof obj=='object'){var arr=new Array();for(var key in obj){var str=null;if(head!=''){str=obj2str(obj[key],head+'['+key+']')}else{str=obj2str(obj[key],key)}
if(str!=null){arr.push(str)}}
return arr.join('&')}else if((typeof head=='string'||typeof head=='number')&&(typeof obj=='string'||typeof obj=='number')){return encodeURIComponent(head)+'='+encodeURIComponent(obj)}};var objlength=function(obj){var length=0;for(var key in obj){length++}
return length};var compareObj=function(o1,o2){if(typeof o1!=typeof o2){return !1}else if(typeof o1=='object'){for(var k in o1){if(o2[k]==null){return !1}else{if(!compareObj(o1[k],o2[k])){return !1}}}
for(var k in o2){if(o1[k]==null){return !1}}}else if(o1!=o2){return !1}
return !0};var compare_params=function(p1,p2){if(p1==null&&p2==null){}else if(p1==null||p2==null){return !1}else{return compareObj(p1,p2)}
return !0};var _tsk=this;var all_opts={};this.params={};this.fparams={};this.ready=function(opts,params){all_opts=$.extend({},all_opts,opts);_tsk.params=params;_tsk.initialize()};this.get_params=function(){return $.extend({},this.params);return this.params};this.set_param=function(pname,pvalue){if(_tsk.params==null){_tsk.params={}}
_tsk.params[pname]=pvalue};this.has_param=function(pname){if(_tsk.params==null){return !1}
if(typeof _tsk.params[pname]=='undefined'){return !1}
return !0};this.set_per_page=function(per_page){_tsk.addparams({tskl:per_page,tskp:1})};this.set_default_per_page=function(per_page){_tsk.fparams={tskl:per_page};_tsk.addparams({tskp:null})};this.set_page=function(page){_tsk.addparams({tskp:page})};this.event_action=function(){$('a[href].tosakanth-action').unbind('click.tosakanth');$('a[href].tosakanth-action').bind('click.tosakanth',function(event){event.preventDefault();var href=$(this).attr('href');if(event.shiftKey||event.altKey||event.ctrlKey){return !0}else{_tsk.reload(href);return !1}});$('a[href].tosakanth-reload').unbind('click.tosakanth');$('a[href].tosakanth-reload').bind('click.tosakanth',function(event){event.preventDefault();var href=$(this).attr('href');if(event.shiftKey||event.altKey||event.ctrlKey){return !0}else{_tsk.reload(!0);return !1}});$('[orderby].tosakanth-orderby').unbind('click.tosakanth');$('[orderby].tosakanth-orderby').bind('click.tosakanth',function(event){var tsko=[];if(_tsk.has_param('tsko')){tsko=_tsk.params.tsko.split('+')}
_tsk.set_param('tsko',tsko.join(','));var orderby=$(this).attr('orderby');var ascbool=!1;if($(this).attr('direct')==null||$(this).attr('direct')=='asc'){}else{ascbool=!0}
var ooo=(ascbool?'':'-')+orderby;if(event.ctrlKey){var action=!1;for(var i in tsko){var tmp=tsko[i];if(tmp==orderby||tmp=='-'+orderby){tsko[i]=ooo;action=!0;break}}
if(!action){tsko.push(ooo)}}else{tsko=[];tsko.push(ooo)}
var aparams={tsko:tsko.join(','),tskp:null};_tsk.addparams(aparams)});if(_tsk.has_param('tsko')){var tsko=_tsk.params.tsko.split(',');$('[orderby][direct].tosakanth-orderby').removeAttr('direct');for(var i in tsko){var ooo=tsko[i];var orderby=ooo;var direct='asc';if(ooo.indexOf('-')==0){direct='desc';orderby=ooo.substr(1)}else{}
$('[orderby='+orderby+'].tosakanth-orderby').attr('direct',direct)}}};this.initialize=function(){if(typeof history.pushState!=='undefined'){_tsk.event_action();window.onpopstate=function(event){var tmp_newparams={};if(typeof event.state=='undefined'||event.state==null){var href=location.href;tmp_newparams=str2obj(href)}else{tmp_newparams=event.state}
if(!compare_params(_tsk.params,tmp_newparams)){action_params=tmp_newparams;_tsk.ajax()}}}};this.stop=function(){$('.tosakanth-loading').remove();$.each(_ajaxnows,function(k,v){if(v!=null){v.abort()}})};function hash_action(str){acion_params=str2obj(str);_tsk.ajax()}
function merge_params(nparams){var params=$.extend({},_tsk.params);$.each(nparams,function(k,v){if(v==null){delete params[k]}else{params[k]=v}});return params}
function new_params(params){var old_params=_tsk.params;var n_params={};$.each(params,function(k,v){if(typeof old_params[k]=='undefined'){n_params[k]=v}else if(old_params[k]!=v){n_params[k]=v}});$.each(old_params,function(k,v){if(typeof params[k]=='undefined'){n_params[k]=null}});return n_params}
var action_params={};function pushState_action(str){var params=str2obj(str);action_params=params;history.pushState(params,"",str);_tsk.ajax()}
function param_action(nparams){var params={};if(typeof nparams=='undefined'){params=action_params}else{params=merge_params(nparams);action_params=params}
var str='?'+obj2str(params);if(str=='?'){var href=location.href;str=href.replace(/\?.*/,'')}
if(typeof history.pushState=='undefined'){location.href=str}else{history.pushState(params,"",str);_tsk.ajax()}}
function fparam_action(){_tsk.ajax()}
this.get_href=function(add_params){var params=merge_params(add_params);var str='?'+obj2str(params);var href=location.href;var url=href.replace(/\?.*/,'');return url+str};this.update_href=function(ele,add_params){var href=$(ele).attr('href');var params=str2obj(href);$.each(add_params,function(k,v){if(v==null){delete params[k]}else{params[k]=v}});var str='?'+obj2str(params);var new_href=href.replace(/\?.*/,str);$(ele).attr('href',new_href)};this.addparams=function(params){param_action(params)};this.addfparams=function(params){$.each(params,function(k,v){if(v==null){delete _tsk.fparams[k]}else{_tsk.fparams[k]=v}});fparam_action()};this.setparams=function(params){action_params=$.extend({},params);param_action()};this.reload=function(href){if(typeof href=='undefined'||href==!0||href==null){_tsk.ajax()}else{if(typeof history.pushState=='undefined'){location.href=location.href}else{pushState_action(href)}}};var events={};this.bind=function(event_name,callback,newevent){if(typeof newevent!='undefined'){events[event_name]=[callback]}else{if(events[event_name]==null)events[event_name]=[];events[event_name].push(callback)}};this.unbind=function(event_name){if(events[event_name]!=null){delete events[event_name]}};this.trigger=function(event_name,args){if(events[event_name]!=null){$.each(events[event_name],function(k,v){v(args)})}};var now_key=null;var dft_settings={show_url:null,request_url:null,data_ele:null,page_ele:null,argname:{"page":"tskp","per_page":"tskl","order_by":"tsko"}};this.now_setting=function(){var settings=dft_settings;if(typeof all_opts[now_key]!=='undefined'){settings=$.extend({},dft_settings,all_opts[now_key])}
return settings};var _ajaxnow=null;var _ajaxnows={};this.ajax=function(){_tsk.trigger('before_reload_success');var params=$.extend({},action_params);var nparam=new_params(params);$.each(all_opts,function(k,v){var settings=$.extend({},dft_settings,v);var ajax_action=!1;$.each(settings.argname,function(kk,vv){if(typeof nparam[vv]!='undefined'){ajax_action=!0;return !1}});if(ajax_action){if(typeof _ajaxnows[k]!='undefined')_ajaxnows[k].abort();if($('.tosakanth-loading').length==0){$('body').append('<div class="tosakanth-loading"><span>กำลังโหลด...</span></div>')}
_ajaxnows[k]=$.ajax({type:'GET',url:settings.request_url,dataType:'json',data:obj2str(params),success:function(response){if(response===null||response===''||typeof response==='undefined'){}else if(response.success){var view=response.data;if(view.data!=null){$(settings.data_ele).html(view.data)}
if(view.page!=null){$(settings.page_ele).html(view.page)}
_tsk.event_action();var args={};args.key=k;args.count_all=view.count_all;_tsk.params=params;action_params={};_tsk.trigger('after_reload_success',args)}else{if(response.data=='NOTLOGIN'){window.location.href=site_url()}}},error:function(jqXHR,textStatus){},complete:function(){_tsk.fparams={};delete _ajaxnows[k];if(!is_ajaxnow()){$('.tosakanth-loading').remove()}}})}})};function is_ajaxnow(){var sss=!1;$.each(_ajaxnows,function(k,v){sss=!0;return !1});return sss}}})(jQuery)