(function(window,$){var lnwmsg=new function(){var lnwmsg_url="https://lnwmsg.com/";var lnwmsg_noti_url=lnwmsg_url+"jsonp/notifications?lnwmsg_jsonp=?";var lnwmsg_count_url=lnwmsg_url+"jsonp/count_notifications?lnwmsg_jsonp=?";var lnwmsg_read_url=lnwmsg_url+"jsonp/read?lnwmsg_jsonp=?";var lnwmsg_offset=0;var is_loading_msg=!1;var notis=[];var limit=10;var can_load=!0;this.load_msg=function(isclear,callback){if(is_loading_msg){return}
var offset=0;if(!isclear){offset=notis.length;can_load=!0}
if(!can_load){return}
var data={data:LNWACCOUNTS_COOKIE_DATA,offset:offset,limit:limit};is_loading_msg=!0;$.getJSON(lnwmsg_noti_url,data,function(rdata){if(rdata.success){if(isclear){notis=[]}
notis=notis.concat(rdata.notifications);callback(notis);if(rdata.notifications.length<limit){can_load=!1}}
is_loading_msg=!1})}
this.count_msg=function(callback){var data={data:LNWACCOUNTS_COOKIE_DATA};$.getJSON(lnwmsg_count_url,data,function(rdata){if(rdata.success){callback(rdata.count)}})}};var lnwpay=new function(){};Vue.component('lb-component',{props:{is_login:{type:Number,default:0},favshops:{default:null},is_lnwpay_bar:{type:String,default:'0'},head_text:{type:String,default:null},head_image:{type:String,default:null},head_url:{type:String,default:null},lnwpoint_data:{default:null}},data:function(){return{noti_data:[],noti_num:null,show_favshops_num:8,lnwpoint:{available_balance:null,available_money:null},is_show_lnwpay_helper:!1,product_list:[{key:'lnwshop',url:'https://www.lnwshop.com',desc:'เปิดร้านค้าออนไลน์ฟรี การันตี 600,000 ร้าน',is_new:!1},{key:'lnwpay',url:'https://www.lnwpay.com',desc:'ระบบรับชำระเงินแทน ประกันได้รับสินค้า 100%',is_new:!1},{key:'lnwmall',url:'https://www.lnwmall.com',desc:'ห้างสุดชิคช้อปปิ้งออนไลน์ รีวิวจากผู้ซื้อตัวจริง',is_new:!1},{key:'lnwdropship',url:'https://www.lnwdropship.com',desc:'รวมสินค้าที่รับตัวแทนจำหน่าย เริ่มขายได้ทันที',is_new:!0},{key:'lnwpickpack',url:'https://www.lnwpickpack.com',desc:'บริการโกดังสินค้าพร้อม เก็บ-แพ็ค-ส่ง',is_new:!0},{key:'bloglnw',url:'https://blog.lnw.co.th',desc:'ติดตามข้อมูลล่าสุด บล็อกน่ารู้ โปรโมชั่นเด็ด',is_new:!1}]}},computed:{USERDATA:function(){return USERDATA},show_lnwpoints:function(){if(this.lnwpoint.available_balance==null){return ''}
if(typeof number_format=='function'){return number_format(this.lnwpoint.available_balance)}
return this.lnwpoint.available_balance},head:function(){var h={is_bb:!1,image:base_url('system/application/templates/lnwshop/default/_images/lnwpay/lnwpaybar/lnwshop_logo_white.png'),image_alt:'LnwShop',text:null,height:11,url:null,};if(this.head_image||this.head_text){h.is_bb=!0;if(this.head_image){h.image=this.head_image;h.height=40}else{h.image=null}
if(this.head_text){h.text=this.head_text;h.image_alt=this.head_text}else{h.text=null}
if(this.head_url){h.url=this.head_url}}
return h},is_favshop:function(){if(this.favshops!=null){var len=this.favshops.filter(function(shop){return(shop.shop_id==WEBID)}).length;return(len>0)}
return !1},notis:function(){var that=this;var lnwmsg_url="https://lnwmsg.com/";return this.noti_data.map(function(nt){var nt_extra={};if((typeof nt.extra=='undefined')||(nt.extra==null)){}else if(typeof nt.extra=='string'){nt_extra=JSON.parse(nt.extra)}else{nt_extra=nt.extra}
var url='';if(typeof nt_extra.url!='undefined'){var url=nt_extra.url;if(typeof nt.tmp_secret!='undefined'){url=lnwmsg_url+'url?n='+nt.notification_id+'&t='+nt.tmp_secret}}
var className=[];className.push(that.get_msg_class(nt.type));if(nt.status!='read'){className.push('new_noti')}
var nt_message=nt.message;nt_message=text(nt_message);nt_message=nt_message.replace('[b][/b]','');nt_message=nt_message.replace(/\[b\](.+?)\[\/b\]/g,'<b>$1</b>');nt_message=nt_message.replace('[i][/i]','');nt_message=nt_message.replace(/\[i\](.+?)\[\/i\]/g,'<i>$1</i>');var image=null;var image_class=[];var nt_type=nt.type.split('/');var nt_extra=nt.extra;if(nt_type.length>2){if(nt_type[1]=='owner'){if(typeof nt_extra.user_avatar!='undefined'){image=img_src(nt_extra.user_avatar,'user',50,50);image_class.push('user_format')}
if(typeof nt_type[2]!='undefined'&&nt_type[2]=='broadcast'){image=img_src('images/lnwshop_admin_avatar.png');image_class.push('user_format')}}else if(nt_type[1]=='user'&&nt_type[2]=='webboard'){if(typeof nt_extra.user_avatar!='undefined'){image=img_src(nt_extra.user_avatar,'user',50,50);image_class.push('user_format')}}else if(nt_type[1]=='user'){if(typeof nt_extra.owner_avatar!='undefined'){image=img_src(nt_extra.owner_avatar,'user',50,50);image_class.push('shop_format')}}else if(nt_type[1]=='buyer'){if(typeof nt_extra.seller_avatar!='undefined'){image=img_src(nt_extra.seller_avatar,'user',50,50);image_class.push('shop_format')}}else if(nt_type[1]=='seller'){if(typeof nt_extra.buyer_avatar!='undefined'){image=img_src(nt_extra.user_avatar,'user',50,50);image_class.push('user_format')}}}
return{className:className,url:url,image:image,image_class:image_class,message:nt_message,time:nt.time,time_diff:nt.time_diff}})}},methods:{toggle_productPopup:function(){$('body').toggleClass('show_lbProductPopup')},show_lang:function(){if(arguments.length==0){return ''}
if(typeof __lnw__!=='undefined'&&typeof __lnw__.show_lang!=='undefined'){return __lnw__.show_lang.apply(__lnw__,arguments)}
var dft_lang_texts={'LB-PROFILE':'ข้อมูลบุคคล','RECEIVER_ADDRESS':'ที่อยู่จัดส่ง','LB-RESET-PSW':'เปลี่ยนรหัสผ่าน','LB-NOTIFICATION':'ข้อความแจ้งเตือน','LB-NO-NOTIFICATION':'ไม่มีข้อความแจ้งเตือน','LB-ALL-NOTIFICATION':'รายการแจ้งเตือนทั้งหมด','LB-MY-FAVSHOP':'ร้านค้าโปรดของฉัน','VIEW_ALL':'ดูเพิ่ม','GADGET-CART-FAV':'บันทึกเป็นร้านโปรด','LB-FAV_DETAIL':'หากคุณต้องการเพิ่มเป็นร้านโปรด กรุณาคลิกเพื่อบันทึก','BUY-DELETE':'ลบ','LB-MY_LNWSHOP_ADDON':'บริการอัพเกรดของฉัน','LB-LOGOUT':'ออกจากระบบ','LB-MY_SHOP':'ร้านค้าของฉัน','LB-MANAGE_SHOP':'จัดการหลังร้าน','LB-CREATE_SHOP':'เริ่มธุรกิจกับ LnwShop เปิดร้านค้าฟรี','LB-CREATE_DETAIL':'แค่คุณมีฝัน เราจะช่วยทำให้เป็นจริง'};var key1=arguments[0];if(typeof dft_lang_texts[key1]=='undefined'){return key1}
return dft_lang_texts[key1]},get_msg_class:function(type){var li_class='';switch(type){case 'lnwshop/owner/webboard/topic':li_class='nTopic';break;case 'lnwshop/owner/webboard/post':case 'lnwshop/user/webboard/post':li_class='nPost';break;case 'lnwshop/owner/contact_us':li_class='nMessage';break;case 'lnwshop/owner/product/discuss':li_class='nDiscus';break;case 'lnwshop/owner/product/review':li_class='nRating';break;case 'lnwshop/owner/payment':case 'lnwshop/user/payment':li_class='nPayment';break;case 'lnwshop/user/order':case 'lnwshop/owner/order':case 'lnwshop/user/shipping':case 'lnwshop/owner/shipping':case 'lnwmall2/seller/order':case 'lnwmall2/buyer/order':case 'lnwmall2/seller/shipping':case 'lnwmall2/buyer/shipping':li_class='nOrder';break;case 'lnwshop/owner/broadcast':li_class='nNotice';break;case 'lnwpay/seller/order/created':li_class='npsCreated';break;case 'lnwpay/buyer/order/created':li_class='npbCreated';break;case 'lnwpay/buyer/payment/informed':li_class='npbInformed';break;case 'lnwpay/buyer/payment/rejected':li_class='npbRejected';break;case 'lnwpay/seller/payment/confirmed':case 'lnwpay/buyer/payment/confirmed':case 'lnwshop/user/payment_confirm':li_class='npConfirmed';break;case 'lnwpay/buyer/order/shipped':case 'lnwshop/user/shipping_confirm':li_class='npbShipped';break;case 'lnwpay/buyer/order/received':li_class='npbReceived';break;case 'lnwpay/seller/order/completed':li_class='npsCompleted';break}
return li_class},load_msg:function(isclear){if(!this.is_login){return}
var that=this;lnwmsg.load_msg(isclear,function(notice){that.noti_data=notice;that.noti_num=null})},toggle_msg:function(ntype){if($('body').hasClass('show_lbNotiPopup')){$('body').removeClass('show_lbNotiPopup')}else{this.load_msg(!0);$('body').addClass('show_lbNotiPopup')}},toggle_fav:function(){var that=this;if($('body').hasClass('show_lbFavPopup')){$('body').removeClass('show_lbFavPopup')}else{if(that.favshops==null){that.$emit('load_profile_user')}
$('body').addClass('show_lbFavPopup')}},favshop_add:function(){__lnw__.favShop.add()},favshop_remove:function(shop_id){__lnw__.favShop.remove_by_id(shop_id)},hide_user:function(){this.$emit('hide_user')},show_user:function(){this.$emit('show_user')},toggle_user:function(){if($('body').hasClass('show_lbUser')){this.hide_user()}else{this.show_user()}},show_favshops_more:function(){this.show_favshops_num=100},load_lnwpoint:function(data){var that=this;if(this.lnwpoint_data!=null){var pointdata={data:this.lnwpoint_data};var lnwpay_url='https://www.lnwpay.com/';$.getJSON(lnwpay_url+'2/api/point/lnwshop/jsonp?lnwpay_jsonp=?',pointdata,function(response){that.lnwpoint.available_balance=response.available_balance;that.lnwpoint.available_money=response.available_money;USERDATA.lnwpoints=response.available_balance;$('#lbAdmin2').remove()})}},show_lnwpay_helper:function(){this.is_show_lnwpay_helper=!0},hide_lnwpay_helper:function(){this.is_show_lnwpay_helper=!1},toggle_lnwpay_helper:function(){this.is_show_lnwpay_helper=!this.is_show_lnwpay_helper}},mounted:function(){var that=this;$(document).bind('mouseup.show_lbProductPopup',function(event){if($('body').hasClass('show_lbProductPopup')){if($(event.target).closest('#lbProductPopup').length==0&&$(event.target).closest('#lbProduct .main').length==0){event.preventDefault();event.stopPropagation();$('body').removeClass('show_lbProductPopup')}}});if(this.is_login){lnwmsg.count_msg(function(num){that.noti_num=num});$('#lbNotiPopup .popup_general .list').bind('scroll',function(event){var element=event.target;if($('body').hasClass('show_lbNotiPopup')){if((element.scrollHeight-element.scrollTop-10)<element.clientHeight){that.load_msg()}}});$(document).bind('mouseup.lbNoti',function(event){if($('body').hasClass('show_lbNotiPopup')){if($(event.target).closest('#lbNoti .noti_general').length==0&&$(event.target).closest('#lbNotiPopup').length==0){event.preventDefault();event.stopPropagation();$('body').removeClass('show_lbNotiPopup')}}});$(document).bind('mouseup.lbFav',function(event){if($('body').hasClass('show_lbFavPopup')){if($(event.target).closest('#lbFav').length==0&&$(event.target).closest('#lbFavPopup').length==0){event.preventDefault();event.stopPropagation();$('body').removeClass('show_lbFavPopup')}}});if(typeof __lnw__!='undefined'){__lnw__.favShop.bind('add-success',function(rdata){if(typeof rdata.shop!='undefined'){if(that.favshops!=null){var xxx=that.favshops.filter(function(shop){return(shop.shop_id==rdata.shop.shop_id)}).length;if(xxx==0){that.favshops.unshift(rdata.shop)}}}});__lnw__.favShop.bind('remove-success',function(rdata){if(typeof rdata.shop_id!='undefined'){if(that.favshops!=null){var remove_idx=null;that.favshops.forEach(function(shop,idx){if(shop.shop_id==rdata.shop_id){remove_idx=idx}});if(remove_idx!=null){that.favshops.splice(remove_idx,1)}}}});__lnw__.favShop.bind('remove_by_id-success',function(shop_id,rdata){if(typeof rdata.shop_id!='undefined'){var remove_idx=null;that.favshops.forEach(function(shop,idx){if(shop.shop_id==rdata.shop_id){remove_idx=idx}});if(remove_idx!=null){that.favshops.splice(remove_idx,1)}}})}
if(this.is_lnwpay_bar=='1'){this.load_lnwpoint()}}},template:'#lb-component-template'});Vue.component('lb-userpanel',{props:['is_login','myshops'],data:function(){return{show_myshops_num:4,LNWACCOUNTS_MANAGE_URL:LNWACCOUNTS_MANAGE_URL,LNWACCOUNTS_LOGOUT_URL:LNWACCOUNTS_LOGOUT_URL}},computed:{USERDATA:function(){return USERDATA},},methods:{show_lang:function(){if(arguments.length==0){return ''}
if(typeof __lnw__!=='undefined'&&typeof __lnw__.show_lang!=='undefined'){return __lnw__.show_lang.apply(__lnw__,arguments)}
var dft_lang_texts={'LB-PROFILE':'ข้อมูลบุคคล','RECEIVER_ADDRESS':'ที่อยู่จัดส่ง','LB-RESET-PSW':'เปลี่ยนรหัสผ่าน','LB-NOTIFICATION':'ข้อความแจ้งเตือน','LB-NO-NOTIFICATION':'ไม่มีข้อความแจ้งเตือน','LB-ALL-NOTIFICATION':'รายการแจ้งเตือนทั้งหมด','LB-MY-FAVSHOP':'ร้านค้าโปรดของฉัน','VIEW_ALL':'ดูเพิ่ม','GADGET-CART-FAV':'บันทึกเป็นร้านโปรด','LB-FAV_DETAIL':'หากคุณต้องการเพิ่มเป็นร้านโปรด กรุณาคลิกเพื่อบันทึก','BUY-DELETE':'ลบ','LB-MY_LNWSHOP_ADDON':'บริการอัพเกรดของฉัน','LB-LOGOUT':'ออกจากระบบ','LB-MY_SHOP':'ร้านค้าของฉัน','LB-MANAGE_SHOP':'จัดการหลังร้าน','LB-CREATE_SHOP':'เริ่มธุรกิจกับ LnwShop เปิดร้านค้าฟรี','LB-CREATE_DETAIL':'แค่คุณมีฝัน เราจะช่วยทำให้เป็นจริง'};var key1=arguments[0];if(typeof dft_lang_texts[key1]=='undefined'){return key1}
return dft_lang_texts[key1]},hide_user:function(){$('body').removeClass('show_lbUser');$('.body-skin').css({'position':''});$('#lnwbody').css({'position':''});$('#lbUserPanel').css({'position':''});var action=function(){$(window).scrollTop(0)};setTimeout(action,600)},show_myshops_more:function(){this.show_myshops_num=100}},mounted:function(){var that=this;if(this.is_login){$(document).bind('mouseup.lbUser',function(event){if($('body').hasClass('show_lbUser')){if($(event.target).closest('#lbMember .lbuser').length==0&&$(event.target).closest('#lbUserPanel').length==0){that.hide_user()}}})}},template:'#lb-userpanel-template'});var lnwbar_vm=new Vue({el:'#lb',data:function(){return{lb_class:'lb_lnwshop',favshops:null,myshops:null,is_login:USERDATA.is_login,wrapper_class:'',product_image:null,product_text:null,}},computed:{component_props:function(){return{is_login:this.is_login,favshops:this.favshops,}},userpanel_props:function(){return{is_login:this.is_login,myshops:this.myshops,}},},mounted:function(){var link=document.createElement('link');link.rel='stylesheet';link.href=base_url('system/application/modules/lnwbar/_css/color_style.min.css');link.type='text/css';document.getElementsByTagName('body')[0].appendChild(link);if(document.getElementsByClassName('lnwwall').length==0){var div=document.createElement('div');div.className='lnwwall';document.getElementsByTagName('body')[0].appendChild(div)}},methods:{set_favshops:function(data){this.favshops=data},set_myshops:function(data){this.myshops=data},load_profile_user:function(){if(!this.is_login){return}
var that=this;$.lnwajax.run('load_myShopZone',!0,{type:'POST',url:site_url("json/profile"),data:{who:'lnwbar'},dataType:'json',success:function(response){if(response===null||response===''||typeof response==='undefined'){}else if(response.error){}else{if(typeof response.myshops!='undefined'){that.myshops=response.myshops}
if(typeof response.favshops!='undefined'){that.favshops=response.favshops}}}})},hide_user:function(){$('body').removeClass('show_lbUser');$('.body-skin').css({'position':''});$('#lnwbody').css({'position':''});$('#lbUserPanel').css({'position':''});var action=function(){$(window).scrollTop(0)};setTimeout(action,600)},show_user:function(){if(this.myshops==null){this.load_profile_user()}
$('body').addClass('show_lbUser');var action=function(){$('.body-skin').css({'position':'fixed'});$('#lnwbody').css({'position':'fixed'});$('#lbUserPanel').css({'position':'absolute'})};setTimeout(action,600)},}});var lnwbar=new function(){var wdata={};var is_mobile=!1;this.loaded=!1;this.init=function(){var that=this;that.loaded=!0;return};this.show_userpanel=function(){lnwbar_vm.show_user()}
this.hide_userpanel=function(){lnwbar_vm.show_user()}
this.vm=function(){return lnwbar_vm}};if(typeof define==="function"&&define.amd){define(function(){return lnwbar})}else if(typeof module!=="undefined"&&module.exports){module.exports=lnwbar}else{window.lnwbar=lnwbar}})(window,jQuery)